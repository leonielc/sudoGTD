{% extends 'base.html' %}

{% block content %}
<section class="panel glass mb-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
      <p class="eyebrow">Register a freshly slain bug</p>
      <h2 class="h4">Deposit fix knowledge in the vault</h2>
    </div>
    <div class="text-end">
      {% if request.args.highlight %}
        <span class="badge bg-success">{{ request.args.highlight }}</span>
      {% else %}
        <span class="badge bg-info text-dark">+40xp avg per entry</span>
      {% endif %}
    </div>
  </div>

  <form class="mt-3" method="post" action="{{ url_for('submit_bug') }}">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Alias</label>
        <input class="form-control" name="alias" placeholder="pixel_knight" required />
      </div>
      <div class="col-md-6">
        <label class="form-label">Bug codename</label>
        <input class="form-control" name="bug_name" placeholder="Infinite recursion hydra" required />
      </div>
      <div class="col-md-4">
        <label class="form-label">Severity</label>
        <select class="form-select" name="severity">
          <option value="low">Low</option>
          <option value="medium" selected>Medium</option>
          <option value="high">High</option>
          <option value="critical">Critical</option>
        </select>
      </div>
      <div class="col-md-8">
        <label class="form-label">Tags</label>
        <input class="form-control" name="tags" placeholder="api, auth, race-condition" />
      </div>
      <div class="col-12">
        <label class="form-label">Buggy code snippet</label>
        <textarea class="form-control" rows="6" name="buggy_code" placeholder="Paste the cursed snippet" required></textarea>
      </div>
      <div class="col-12">
        <label class="form-label">How you fixed it</label>
        <textarea class="form-control" rows="4" name="fix_description" placeholder="Explain the ritual" required></textarea>
      </div>
    </div>
    <div class="d-flex justify-content-between align-items-center mt-3">
      <div>
        <small class="text-muted">Epic submissions unlock surprise relics.</small>
      </div>
      <button class="btn btn-primary">Save to vault</button>
    </div>
  </form>
</section>

<section class="panel glass">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="h5">Recent vault additions</h3>
    <button class="btn btn-sm btn-outline-light" data-roll-story>Generate hype</button>
  </div>
  <div class="list-group list-group-flush">
    {% for report in reports %}
      <article class="list-group-item bg-transparent text-light border-secondary">
        <div class="d-flex justify-content-between">
          <div>
            <p class="mb-1">{{ report['bug_name'] }} â€¢ <span class="text-warning">{{ report['severity']|capitalize }}</span></p>
            <pre class="snippet">{{ report['buggy_code'][:160] }}{% if report['buggy_code']|length > 160 %}...{% endif %}</pre>
          </div>
          <div class="text-end">
            <small class="text-muted">{{ report['alias'] }}</small>
            <div class="badge bg-success mt-1">+{{ report['xp_awarded'] }} xp</div>
          </div>
        </div>
        <p class="text-info small mt-2">{{ report['fix_description'] }}</p>
      </article>
    {% else %}
      <p class="text-muted">Vault awaiting first inscription.</p>
    {% endfor %}
  </div>
</section>

<section class="panel neon mt-4">
  <div class="d-flex justify-content-between align-items-center">
    <h3 class="h5">Daily quests</h3>
    <span class="badge bg-dark text-warning">Rotates hourly</span>
  </div>
  <div class="row g-3 mt-2">
    {% for quest in quests %}
      <div class="col-md-4">
        <div class="quest">
          <p class="quest-title">{{ quest.title }}</p>
          <p class="quest-tip">{{ quest.tip }}</p>
          <span class="badge bg-warning text-dark">{{ quest.reward }}</span>
        </div>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}
